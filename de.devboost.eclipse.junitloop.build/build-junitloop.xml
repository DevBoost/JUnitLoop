<?xml version="1.0" encoding="UTF-8"?>

<!-- 
  This ANT script builds JUnitLoop. 
  It is intended to be executed from Jenkins.
-->

<project basedir=".." default="build-junitloop" name="JUnitLoop Build">
	<property environment="env"/>
	<property name="build_plugin_ID" value="de.devboost.eclipse.junitloop.build"/>
	<property name="buildDir" value="${env.WORKSPACE}/build"/>
	<property name="targetPlatformDir" value="${buildDir}/target-platform"/>

	<target name="clean">
		<delete dir="${buildDir}"/>
	</target>
		
	<target name="compose-target-platform">
		<!-- Unzip target platform -->
		<mkdir dir="${targetPlatformDir}"/>
		<unzip src="${env.WORKSPACE}/svn-Target-Platforms/Eclipse/eclipse-SDK-3.7.2-core/eclipse-SDK-3.7.2-platform-independent-core.zip" dest="${targetPlatformDir}" />
		<unzip src="${env.WORKSPACE}/svn-Target-Platforms/Eclipse/eclipse-SDK-3.7.2-linux/eclipse-SDK-3.7.2-linux-gtk-x86_64-addon.zip" dest="${targetPlatformDir}" />
	</target>
		
	<target name="build-junitloop" depends="clean,compose-target-platform">
		<mkdir dir="${buildDir}"/>

		<echo message="Bootstrap Autobuild tool" />
		<ant antfile="autobuild_bootstrap.xml" dir="${env.WORKSPACE}/svn-autobuild/org.dropsbox.autobuild">
			<property name="build_plugin_path" value="${env.WORKSPACE}/svn-devboost-tools/${build_plugin_ID}"/>
			<property name="build_plugin_id" value="${build_plugin_ID}"/>
		</ant>
	</target>
</project>
